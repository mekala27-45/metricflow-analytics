version: 2

models:
  - name: int_sessions_enriched
    description: "Sessions joined with user context and lifecycle stage"
    columns:
      - name: session_id
        tests: [unique, not_null]
      - name: user_id
        tests: [not_null]

  - name: int_revenue_normalized
    description: "Revenue with MRR normalization and status classification"
    columns:
      - name: payment_id
        tests: [unique, not_null]
      - name: recognized_mrr
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 3000

  - name: int_events_enriched
    description: "Events with user context and feature categorization"
    columns:
      - name: event_id
        tests: [not_null]
      - name: feature_category
        tests:
          - accepted_values:
              values: ['core_analytics', 'platform', 'collaboration', 'configuration', 'support', 'navigation']

  - name: int_user_lifecycle
    description: "User lifecycle state classification"
    columns:
      - name: user_id
        tests: [unique, not_null]
      - name: lifecycle_state
        tests:
          - accepted_values:
              values: ['new', 'inactive', 'churned', 'at_risk', 'power_user', 'active', 'casual']

  - name: int_marketing_attributed
    description: "Multi-touch marketing attribution"
    columns:
      - name: touch_id
        tests: [not_null]

  - name: int_subscription_periods
    description: "Subscription periods with MRR change tracking"
    columns:
      - name: subscription_id
        tests: [unique, not_null]
      - name: mrr_change_type
        tests:
          - accepted_values:
              values: ['new', 'expansion', 'contraction', 'churn', 'renewal']
